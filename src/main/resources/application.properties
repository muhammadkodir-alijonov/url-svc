# ============================================
# APPLICATION BASE CONFIG
# ============================================
quarkus.application.name=url-service

# Disable ALL Dev Services (CRITICAL - we use Kubernetes)
quarkus.devservices.enabled=false
quarkus.redis-client.devservices.enabled=false

# HTTP
quarkus.http.port=8080
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Authorization,Content-Type
quarkus.http.cors.exposed-headers=X-Total-Count

# ============================================
# DATABASE (PostgreSQL)
# ============================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=admin
quarkus.datasource.password=admin123
quarkus.datasource.jdbc.url=jdbc:postgresql://postgres:5432/url_shortener
quarkus.datasource.jdbc.max-size=50
quarkus.datasource.jdbc.min-size=10
quarkus.datasource.devservices.enabled=false

# Flyway Migration (Production-ready)
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.baseline-version=0
quarkus.flyway.locations=classpath:db/migration
quarkus.flyway.clean-at-start=false
quarkus.flyway.repair-at-start=true

# Hibernate ORM (no schema generation - Flyway handles it)
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.database.validation=none
quarkus.hibernate-orm.validate-in-dev-mode=false
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.log.format-sql=true

# ============================================
# VALKEY (Redis)
# ============================================
quarkus.redis.hosts=redis://valkey:6379
quarkus.redis.client-type=standalone
quarkus.redis.timeout=3s
quarkus.redis.max-pool-size=100
quarkus.redis.devservices.enabled=false

# ============================================
# PULSAR (Message Broker)
# ============================================
quarkus.pulsar.client.serviceUrl=pulsar://pulsar:6650

# ============================================
# KEYCLOAK (OIDC)
# ============================================
quarkus.oidc.auth-server-url=http://localhost:30180/realms/url-shortener
quarkus.oidc.client-id=url-shortener-client
quarkus.oidc.credentials.secret=**my sec keyyyy**
quarkus.oidc.tls.verification=none
quarkus.oidc.discovery-enabled=true

# SmallRye JWT Configuration (must match token claims)
mp.jwt.verify.issuer=http://localhost:30180/realms/url-shortener
mp.jwt.verify.audiences=account
mp.jwt.verify.publickey.location=http://localhost:30180/realms/url-shortener/protocol/openid-connect/certs
smallrye.jwt.verify.aud=account
smallrye.jwt.verify.key-format=JWK

# Keycloak role mapping (extract roles from realm_access.roles)
smallrye.jwt.path.groups=realm_access/roles
smallrye.jwt.claims.groups=realm_access/roles


# ============================================
# SECURITY
# ============================================
quarkus.security.users.embedded.enabled=false

# Public endpoints (no auth required)
quarkus.http.auth.permission.public-swagger.paths=/q/swagger-ui/*,/q/openapi,/q/swagger-ui
quarkus.http.auth.permission.public-swagger.policy=permit
quarkus.http.auth.permission.public-health.paths=/q/health/*,/health,/q/metrics,/metrics
quarkus.http.auth.permission.public-health.policy=permit
quarkus.http.auth.permission.public-dev.paths=/q/dev*
quarkus.http.auth.permission.public-dev.policy=permit
quarkus.http.auth.permission.public-auth.paths=/api/auth/*
quarkus.http.auth.permission.public-auth.policy=permit
quarkus.http.auth.permission.public-redirect.paths=/{shortCode}
quarkus.http.auth.permission.public-redirect.policy=permit

# Authenticated endpoints require valid JWT
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# ============================================
# OPENAPI / SWAGGER
# ============================================
quarkus.smallrye-openapi.info-title=URL Shortener API
quarkus.smallrye-openapi.info-version=1.0.0
quarkus.smallrye-openapi.info-description=API for URL shortening service
quarkus.smallrye-openapi.info-contact-name=alijonov
quarkus.smallrye-openapi.info-contact-email=alijonov@mk.com

# Swagger UI Config
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.enable=true
quarkus.swagger-ui.path=/q/swagger-ui
quarkus.swagger-ui.title=URL Shortener API

# Disable automatic OIDC security scheme in OpenAPI (we use custom security in code)
quarkus.oidc.authentication.add-openid-scope-automatically=false
quarkus.smallrye-openapi.auto-add-security=false
quarkus.smallrye-openapi.auto-add-security-requirement=false


# ============================================
# LOGGING
# ============================================
quarkus.log.level=INFO
quarkus.log.category."com.example".level=DEBUG
quarkus.log.category."io.quarkus".level=INFO
quarkus.log.category."io.quarkus.oidc".level=DEBUG
quarkus.log.category."io.quarkus.smallrye.jwt".level=DEBUG
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.console.color=true

# ============================================
# METRICS (Prometheus)
# ============================================
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics

# ============================================
# APPLICATION-SPECIFIC CONFIG
# ============================================
app.base-url=https://shortener.by
app.short-code.length=6
app.short-code.max-attempts=10
app.cache.url-ttl=3600
app.rate-limit.shorten=10
app.rate-limit.redirect=1000
app.pulsar.topic=persistent://public/default/click-events
