# ============================================
# PROD PROFILE - Production Kubernetes Environment
# ============================================

# Application Environment
app.environment=prod

# Disable Dev Services (IMPORTANT!)
quarkus.devservices.enabled=false
quarkus.datasource.devservices.enabled=false
quarkus.redis.devservices.enabled=false

# Database (Kubernetes Internal Service)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${DB.url}
quarkus.datasource.username=${DB.username}
quarkus.datasource.password=${DB.password}
quarkus.hibernate-orm.database.generation=none

# Vault Configuration (Kubernetes Internal Service)
quarkus.vault.url=http://vault.url-shortener.svc.cluster.local:8200
quarkus.vault.authentication.client-token=${VAULT_TOKEN:prod-root-token}
quarkus.vault.secret-config-kv-path=secret/url-shortener/prod
quarkus.vault.kv-secret-engine-version=2
quarkus.vault.tls.skip-verify=false
# Make Vault optional - don't fail if secrets are missing
quarkus.vault.secret-config-kv-path-enabled=false
quarkus.vault.renew-grace-period=3600s

# Flyway Migration
quarkus.flyway.locations=db/migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.log-migration-sql=true
quarkus.flyway.clean-at-start=false
quarkus.flyway.repair-at-start=false

# Redis (Kubernetes Internal Service)
quarkus.redis.hosts=redis://valkey.url-shortener.svc.cluster.local:6379

# Pulsar (Kubernetes Internal Service)
quarkus.pulsar.client.serviceUrl=pulsar://pulsar.url-shortener.svc.cluster.local:6650

# Keycloak (Kubernetes Internal Service)
quarkus.oidc.auth-server-url=http://keycloak.url-shortener.svc.cluster.local:8080/realms/url-shortener
quarkus.oidc.tls.verification=required

# SmallRye JWT Configuration
mp.jwt.verify.issuer=http://keycloak.url-shortener.svc.cluster.local:8080/realms/url-shortener
mp.jwt.verify.audiences=account
mp.jwt.verify.publickey.location=http://keycloak.url-shortener.svc.cluster.local:8080/realms/url-shortener/protocol/openid-connect/certs
smallrye.jwt.verify.aud=account
smallrye.jwt.verify.key-format=JWK

# Keycloak role mapping
smallrye.jwt.path.groups=realm_access/roles
smallrye.jwt.claims.groups=realm_access/roles

# Logging - Production
quarkus.log.level=INFO
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=false
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.log.format-sql=false

# HTTP - Production
quarkus.http.port=8080
quarkus.http.cors.origins=https://yourdomain.com,https://short.yourdomain.com
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Authorization,Content-Type
quarkus.http.cors.exposed-headers=X-Total-Count

# Health Checks
quarkus.health.extensions.enabled=true

# Metrics
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
