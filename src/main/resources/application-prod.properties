# ============================================
# PROD PROFILE - Production Kubernetes Environment
# ============================================

# Disable Dev Services (IMPORTANT!)
quarkus.devservices.enabled=false
quarkus.datasource.devservices.enabled=false
quarkus.redis.devservices.enabled=false

# ============================================
# VAULT CONFIGURATION (Kubernetes Internal Service)
# ============================================
quarkus.vault.url=http://vault.url-shorten.svc.cluster.local:8200
quarkus.vault.authentication.client-token=${VAULT_TOKEN:prod-root-token}
quarkus.vault.kv-secret-engine-version=2
quarkus.vault.kv-secret-engine-mount-path=secret
quarkus.vault.tls.skip-verify=false
quarkus.vault.renew-grace-period=3600s

# Vault Config Source - Enable automatic config loading from Vault
quarkus.vault.secret-config-kv-path=url-shorten/prod/database/postgres,url-shorten/prod/keycloak/config,url-shorten/prod/redis/config,url-shorten/prod/pulsar/config,url-shorten/prod/application/config

# ============================================
# DATABASE (PostgreSQL)
# ============================================
quarkus.datasource.db-kind=postgresql
quarkus.hibernate-orm.database.generation=none

# Flyway Migration
quarkus.flyway.locations=db/migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.log-migration-sql=true
quarkus.flyway.clean-at-start=false
quarkus.flyway.repair-at-start=false

# ============================================
# KEYCLOAK
# ============================================
# TLS verification (environment-specific, not secret)
quarkus.oidc.tls.verification=required
quarkus.oidc.discovery-enabled=true
quarkus.oidc.authentication.add-openid-scope-automatically=true

# JWT Settings (not secrets, environment-specific)
mp.jwt.verify.audiences=account
smallrye.jwt.verify.aud=account
smallrye.jwt.verify.key-format=JWK

# Keycloak role mapping
smallrye.jwt.path.groups=realm_access/roles
smallrye.jwt.claims.groups=realm_access/roles

# ============================================
# LOGGING (Production)
# ============================================
quarkus.log.level=INFO
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=false
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.log.format-sql=false

# ============================================
# HTTP (Production)
# ============================================
quarkus.http.port=8080
quarkus.http.cors.origins=https://shorten.com,https://*.shorten.com
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Authorization,Content-Type
quarkus.http.cors.exposed-headers=X-Total-Count

# ============================================
# HEALTH CHECKS & METRICS
# ============================================
quarkus.health.extensions.enabled=true
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
