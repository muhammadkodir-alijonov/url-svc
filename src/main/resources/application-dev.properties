# ============================================
# DEV PROFILE - Kubernetes NodePorts
# ============================================

# Application Environment
app.environment=dev

# Disable Dev Services (IMPORTANT!)
quarkus.devservices.enabled=false
quarkus.datasource.devservices.enabled=false
quarkus.redis.devservices.enabled=false

# Database (Kubernetes NodePort 30432)
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:30432/url_shortener
quarkus.datasource.username=admin
quarkus.datasource.password=admin123

# Vault Configuration (Kubernetes NodePort 30200)
quarkus.vault.url=http://localhost:30200
quarkus.vault.authentication.client-token=dev-root-token
quarkus.vault.kv-secret-engine-version=2
quarkus.vault.tls.skip-verify=true
# Make Vault optional - don't fail if Vault is unavailable
quarkus.vault.health.enabled=false

# Flyway Migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.clean-at-start=true
quarkus.flyway.repair-at-start=true

# Redis (Kubernetes NodePort 30379)
quarkus.redis.hosts=redis://localhost:30379

# Pulsar (Kubernetes NodePort 30650)
quarkus.pulsar.client.serviceUrl=pulsar://localhost:30650

# Keycloak (Kubernetes NodePort 30180)
quarkus.oidc.auth-server-url=http://localhost:30180/realms/url-shortener
quarkus.oidc.tls.verification=none

# SmallRye JWT Configuration
mp.jwt.verify.issuer=http://localhost:30180/realms/url-shortener
mp.jwt.verify.audiences=account
mp.jwt.verify.publickey.location=http://localhost:30180/realms/url-shortener/protocol/openid-connect/certs
smallrye.jwt.verify.aud=account
smallrye.jwt.verify.key-format=JWK

# Keycloak role mapping
smallrye.jwt.path.groups=realm_access/roles
smallrye.jwt.claims.groups=realm_access/roles

# Public endpoints (no authentication required)
quarkus.http.auth.permission.public.paths=/api/auth/register,/api/auth/login,/api/auth/refresh,/q/*,/{shortCode}
quarkus.http.auth.permission.public.policy=permit

# Authenticated endpoints
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# App Config Overrides
app.base-url=http://localhost:3000
app.short-code.length=7
app.short-code.max-attempts=10
app.cache.url-ttl=3600
app.rate-limit.shorten=100
app.rate-limit.redirect=1000
app.pulsar.topic=url-shortener-clicks

# Dev Logging
quarkus.log.level=DEBUG
quarkus.log.category."com.example".level=DEBUG
quarkus.log.category."io.quarkus.oidc".level=DEBUG
quarkus.log.category."io.quarkus.smallrye.jwt".level=DEBUG

