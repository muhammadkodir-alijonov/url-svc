# ============================================
# DEV PROFILE - Kubernetes NodePorts
# ============================================

# Application Environment
app.environment=dev

# Disable Dev Services (IMPORTANT!)
quarkus.devservices.enabled=false
quarkus.datasource.devservices.enabled=false
quarkus.redis.devservices.enabled=false

# ============================================
# DATABASE (PostgreSQL) - Kubernetes NodePort 30432
# ============================================
# Connection details come from Vault: secret/url-shortener/dev/database/postgres
# But we need to specify the JDBC URL here as it's used early in startup
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:30432/url_shortener
# Username and password will be loaded from Vault automatically

# ============================================
# VAULT CONFIGURATION (Kubernetes NodePort 30200)
# ============================================
# Vault Server Connection
quarkus.vault.url=http://localhost:30200
quarkus.vault.authentication.client-token=dev-root-token
quarkus.vault.kv-secret-engine-version=2
quarkus.vault.tls.skip-verify=true
quarkus.vault.health.enabled=false

# Vault Config Source - Read configuration from multiple Vault paths
# Database secrets
quarkus.vault.secret-config-kv-path.database=secret/url-shortener/dev/database/postgres
# Keycloak secrets
quarkus.vault.secret-config-kv-path.keycloak=secret/url-shortener/dev/keycloak/config
# Redis secrets
quarkus.vault.secret-config-kv-path.redis=secret/url-shortener/dev/redis/config
# Pulsar secrets
quarkus.vault.secret-config-kv-path.pulsar=secret/url-shortener/dev/pulsar/config
# Application secrets
quarkus.vault.secret-config-kv-path.application=secret/url-shortener/dev/application/config

# Config source priority (higher number = higher priority)
quarkus.vault.config-ordinal=270

# Flyway Migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.clean-at-start=true
quarkus.flyway.repair-at-start=true

# ============================================
# REDIS - Configuration from Vault
# ============================================
# Redis host URL will come from Vault: secret/url-shortener/dev/redis/config
# Fallback if Vault is not available
%dev.quarkus.redis.hosts=redis://localhost:30379

# ============================================
# PULSAR - Configuration from Vault
# ============================================
# Pulsar service URL will come from Vault: secret/url-shortener/dev/pulsar/config
# Fallback if Vault is not available
%dev.quarkus.pulsar.client.serviceUrl=pulsar://localhost:30650

# ============================================
# KEYCLOAK - Configuration from Vault
# ============================================
# Keycloak configuration will come from Vault: secret/url-shortener/dev/keycloak/config
# We only keep TLS verification setting here as it's environment-specific
quarkus.oidc.tls.verification=none

# JWT Settings (Environment-specific, not secret)
smallrye.jwt.verify.aud=account
smallrye.jwt.verify.key-format=JWK
smallrye.jwt.path.groups=realm_access/roles
smallrye.jwt.claims.groups=realm_access/roles


# Public endpoints (no authentication required)
quarkus.http.auth.permission.public.paths=/api/auth/register,/api/auth/login,/api/auth/refresh,/q/*,/{shortCode}
quarkus.http.auth.permission.public.policy=permit

# Authenticated endpoints
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# ============================================
# APPLICATION CONFIG - From Vault
# ============================================
# Application-specific configuration will come from Vault: secret/url-shortener/dev/application/config

# ============================================
# LOGGING (Dev Mode)
# ============================================
quarkus.log.level=DEBUG
quarkus.log.category."com.example".level=DEBUG
quarkus.log.category."io.quarkus.oidc".level=DEBUG
quarkus.log.category."io.quarkus.smallrye.jwt".level=DEBUG

