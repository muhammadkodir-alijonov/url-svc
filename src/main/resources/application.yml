# ============================================
# APPLICATION
# ============================================
quarkus:
  application:
    name: url-service

  http:
    port: 8080
    cors:
      ~: true
      origins: "*"
      methods: "GET,POST,PUT,DELETE,OPTIONS"
      headers: "Authorization,Content-Type"
      exposed-headers: "X-Total-Count"

  # ============================================
  # DATABASE (PostgreSQL)
  # ============================================
  datasource:
    db-kind: postgresql
    username: admin
    password: admin123
    jdbc:
      url: jdbc:postgresql://localhost:5432/url_shortener
      max-size: 50
      min-size: 10

  hibernate-orm:
    database:
      generation: update  # For dev (use 'validate' in production!)
    log:
      sql: true
      format-sql: true
    jdbc:
      statement-batch-size: 20

  # ============================================
  # VALKEY (Redis)
  # ============================================
  redis:
    hosts: redis://localhost:6379
    # or for Docker: redis://valkey:6379
    client-type: standalone
    timeout: 3s
    max-pool-size: 100

  # ============================================
  # PULSAR (Message Broker)
  # ============================================
  pulsar:
    client:
      serviceUrl: pulsar://pulsar:6650


  # ============================================
  # KEYCLOAK (OIDC)
  # ============================================
  oidc:
    auth-server-url: http://localhost:8180/realms/url-shortener
    # or for Docker: http://keycloak:8080/realms/url-shortener
    client-id: shortener-backend
    credentials:
      secret: "**CHANGE_IN_PRODUCTION**"
    tls:
      verification: none  # Only for dev! Use 'required' in prod

    # JWT validation
    token:
      issuer: http://localhost:8180/realms/url-shortener
      audience: account

    # JWKS caching (improves performance)
    jwks:
      cache-enabled: true
      cache-time-to-live: 600  # 10 minutes

  # ============================================
  # SECURITY
  # ============================================
  security:
    users:
      embedded:
        enabled: false  # No embedded users, only Keycloak

  # ============================================
  # OPENAPI / SWAGGER
  # ============================================
  smallrye-openapi:
    info-title: URL Shortener API
    info-version: 1.0.0
    info-description: API for URL shortening service
    info-contact-name: alijonov
    info-contact-email: alijonov@mk.com

    # Security scheme for Swagger UI
    security-scheme: bearer
    security-scheme-name: bearer-jwt
    security-scheme-description: "JWT token from Keycloak"
    jwt-security-scheme: true

  swagger-ui:
    always-include: true
    path: /swagger-ui
    title: URL Shortener API

  # ============================================
  # LOGGING
  # ============================================
  log:
    level: INFO
    category:
      "dev.shortener":
        level: DEBUG
      "io.quarkus":
        level: INFO
    console:
      enable: true
      format: "%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"
      color: true

  # ============================================
  # METRICS (Prometheus)
  # ============================================
  micrometer:
    export:
      prometheus:
        enabled: true
        path: /metrics

# ============================================
# APPLICATION-SPECIFIC CONFIG
# ============================================
app:
  base-url: https://shortener.by
  short-code:
    length: 6
    max-attempts: 10
  cache:
    url-ttl: 3600  # 1 hour (seconds)
  rate-limit:
    shorten: 10  # per minute
    redirect: 500  # per minute
  pulsar:
    topic: persistent://public/default/click-events
